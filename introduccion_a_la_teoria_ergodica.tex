\chapter{Introducción a la Teoría Ergódica}

En este capítulo se desarrollarán los conceptos necesarios para  demostrar el Teorema Ergódico de Birkhoff que será de utilidad en el siguiente capítulo para analizar las propiedades de la rotación irracional de círculo.

Los resultados de este capítulo se encuentran en \cite{youtube} en forma de video de las clases del curso de Teoría Ergódica del International Centre for Theoretical Physics.

A partir de ahora consideraremos a $X$ como un espacio métrico compacto, a $\Sigma$ como un $\sigma$-álgebra de $X$ y \mbox{$f \in \mathcal{C}(X)$ donde $\mathcal{C}(X) = \{f: X \rightarrow X: f \text{ continua}\}$}.

A continuación se van a enumerar las definiciones de los conceptos usados en este capítulo.

\begin{definicion}
	Sea $(X,\Sigma,\mu)$ un espacio de probabilidad. La medida $\mu$ se dice $f$-invariante si	
	\begin{equation}
		\mu(f^{-1}A) = \mu A
	\end{equation}
	
	para cualquier $A \in \Sigma$.
\end{definicion}

\begin{definicion}
	Sea $(X,\Sigma,\mu)$ un espacio de probabilidad  con $\mu$ $f$-invariante. Se define $\Sigma_f$ como	
	\begin{equation}
		\Sigma_f = \{ A \in \Sigma: \mu(f^{-1}A) = \mu A \}
	\end{equation}
\end{definicion}

Con esta definición se puede probar que $\Sigma_f$ es un $\sigma$-álgebra. Se puede observar que $\emptyset \in \Sigma_f$ por que $\mu(f^{-1} \emptyset) = \mu \emptyset = 0$. Sea $A \in \Sigma_f$. Entonces $\mu(f^{-1}(X \setminus A)) =  \mu(X \setminus f^{-1}A) = 1 - \mu(f^{-1}A) = 1 - \mu A = \mu(X \setminus A)$. Luego $X \setminus A \in \Sigma$. Por último, sea $\{A_n\}_{n \geq 1} \subset \Sigma_f$. Entonces $\mu(f^{-1}A_n \setminus A_n) = 0$. Se sigue que $\mu(f^{-1}(\cup_{n \geq 1} A_n) \setminus (\cup_{n \geq 1} A_n)) \leq \mu(\cup_{n \geq 1} (f^{-1}A_n \setminus A_n)) \leq \sum_{n \geq 1} \mu(f^{-1}A_n \setminus A_n) = 0$. Por lo tanto $\mu(f^{-1}(\cup_{n \geq 1} A_n) \setminus (\cup_{n \geq 1} A_n)) = 0$. Con esto se concluye que $\Sigma_f$ es un $\sigma$-álgebra. 

\begin{definicion}
	Sea $(X,\Sigma,\mu)$ un espacio de probabilidad. $\mu$ es ergódica si para cualquier $A \in \Sigma$ se tiene	
	\begin{equation}
		\mu A = 0 \vee \mu A = 1
	\end{equation}
\end{definicion}

\begin{definicion}
	Se define $\mathcal{M}(X,\Sigma)$ de la siguiente manera	
	\begin{equation}
		\mathcal{M}(X,\Sigma) = \{\mu: \Sigma \rightarrow \mathbb{R}: \mu \text{ es un medida de probabilidad} \}
	\end{equation}
\end{definicion}

\begin{definicion}
	Se define $\mathcal{M}_f(X,\Sigma)$ de la siguiente manera	
	\begin{equation}
		\mathcal{M}_f(X,\Sigma) = \{ \mu \in \mathcal{M}(X,\Sigma): \mu(f^{-1} A) = \mu A, \forall A \in \Sigma \}
	\end{equation}
\end{definicion}

\begin{definicion}
	Se define $\varepsilon_f(X,\Sigma)$ de la siguiente manera	
	\begin{equation}
		\varepsilon_f(X,\Sigma) = \{ \mu \in \mathcal{M}(X,\Sigma): \mu A = 0 \vee \mu A = 1, \forall A \in \Sigma \text{ con } f^{-1}A = A  \}
	\end{equation}
\end{definicion}

\begin{definicion}
	Sea $(X,\Sigma,\mu)$ un espacio de probabilidad. Entonces para cualquier conjunto $A \subset \Sigma$, $f_*: \mathcal{M}(X,\Sigma) \rightarrow \mathcal{M}(X,\Sigma)$ se define como	
	\begin{equation}
		f_*\mu(A) = \mu(f^{-1}(A))
	\end{equation}
\end{definicion}

Las definiciones anteriores servirán para analizar las propiedades topológicas del espacio de medida de probabilidad pero aún falta el concepto de convergencia dentro de ese conjunto. Para eso se definirá el concepto de la convergencia en la topología débil* que servirá para tener una noción de como afirmar que una sucesión de medidas de probabilidad converge a una medida probabilidad.

\begin{definicion}
	Sea $(\mu_n) \subset \mathcal{M}(X,\Sigma)$ una sucesión de medidas de probabilidad y $\mu \in \mathcal{M}(X,\Sigma)$. Se dice que $\mu_n \rightarrow \mu$ en la topología débil* si
	\begin{equation}
		\int \varphi d\mu_n \rightarrow \int \varphi d\mu, \forall \varphi \in \mathcal{C}(X)
	\end{equation}
\end{definicion}

A continuación se analizará la existencia de medidas $f$-invariantes y la topología del conjunto de medidas de probabilidad $f$-invariante una vez que ya se prueba la existencia de alguna medida de ese tipo. Ese análisis se hará a través del desarrollo del Teorema de Krylov-Bugoliubov dividiendo la demostración en varios lemas.

\begin{lema}\label{lema1_krylov-bugoliubov}
	Sea $(X,\Sigma,\mu)$ un espacio de probabilidad y sean $\varphi \in \mathcal{C}(X)$. Entonces
	
	\begin{equation}
		\int_A \varphi d(f_*\mu)=\int_A \varphi \circ f d\mu, \forall A \in \Sigma
	\end{equation}
\end{lema}

\begin{proof}
	Sea $\varphi = \chi_A$ para algún $A \in \Sigma$. Entonces
	\begin{align}
		\int \chi_A d(f_* \mu) &= f_* \mu(A)\\
		&= \mu(f^{-1} A)\\
		&= \int \chi_{f^{-1}A} d\mu\\
		&= \int \chi_A \circ f d\mu
	\end{align}
	
	Esto también se cumple si $\varphi$ fuese una función simple.
	
	Si $\varphi$ fuese una función integrable no negativa entonces $\varphi$ es el límite puntual de una secuencia creciente de $\{ \varphi_n \}$ de funciones simples. Luego la sucesión $\{ \varphi_n \circ f \}$ es una sucesión creciente también de funciones simples que convergen puntualmente a $\varphi \circ f$.
	
	Por definición de integral de Lebesge se tiene
	\begin{align}
		\int_A \varphi_n d(f_* \mu) &\rightarrow \int_A \varphi d(f_* \mu)\\
		\int_A \varphi_n \circ f d\mu &\rightarrow \int_A \varphi \circ f d\mu
	\end{align}
\end{proof}

\begin{lema}
	$f_* \in \mathcal{C}(\mathcal{M}(X,\Sigma))$. 
\end{lema}

\begin{proof}
	Tomemos la sucesión $(\mu_n) \subset \mathcal{M}(X,\Sigma)$ tal que $\mu_n \rightarrow \mu$. Se tiene que demostrar que
	\begin{equation}
		f_* \mu_n \rightarrow f_* \mu
	\end{equation}
	
	Y esto significa que para cualquier $\varphi \in \mathcal{C}(X)$ se tiene que cumplir que
	\begin{equation}
		\int \varphi d(f_* \mu_n) \rightarrow \int \varphi d(f_* \mu)
	\end{equation}
	
	En efecto,
	\begin{equation}
		\int \varphi d(f_* \mu_n) = \int \varphi \circ f d\mu_n \rightarrow \int \varphi \circ f d\mu = \int \varphi d(f_* \mu)
	\end{equation}
	
	Con esto se concluye que $f_* \mu_n \rightarrow f_* \mu$.
\end{proof}

\begin{lema}\label{lema3_krylov}
	Sean $\varphi \in \mathcal{C}(X)$. $\mu \in \mathcal{M}_f(X,\Sigma)$ si y sólo si	
	\begin{equation}
		\int \varphi \circ f d\mu = \int \varphi d\mu
	\end{equation}
\end{lema}

\begin{proof}
	Por el lema \ref{lema1_krylov-bugoliubov} se tiene que $\int \varphi \circ f d\mu = \int \varphi d(f_* \mu)$. Como $\mu \in \mathcal{M}_f(X,\Sigma)$ entonces $f_* \mu = \mu$.
	
	Por lo tanto $\int \varphi \circ f d\mu = \int \varphi d\mu$.
\end{proof}

\begin{lema}\label{krylov-bugoliubov-lema3}
	$\mathcal{M}(X,\Sigma)$ es compacto. 
\end{lema}

\begin{proof}
	Se demostrará que $\mathcal{M}(X,\Sigma)$ es secuencialmente compacto en la topología débil *.
	
	Se sabe que cualquier conjunto compacto de un espacio métrico es secuencialmente compacto y viceversa. La demostración se puede encontrar en \cite{schep}, página 2, Teorema 2.1.
	
	Por otro lado, en \cite{walkden}, página 1-2, sección 10.2, se puede ver la demostración que $\mathcal{M}(X,\Sigma)$ es un espacio métrico. En conclusión, solo se necesita demostrar que $\mathcal{M}(X,\Sigma)$ es secuencialmente compacto para afirmar que es compacto.
	
	Sea $(\mu_n) \subset \mathcal{M}(X,\Sigma)$ una sucesión. Por otro lado, como $\mathcal{C}(X)$ es separable entonces existe un conjunto denso $\{f_n\}_{n \geq 1} \subset \mathcal{C}(X)$. Esto quiere decir que para cualquier $f \in \mathcal{C}(X)$ se tiene que dado un $\epsilon > 0$ existe $f_i, i \in \mathbb{N}$ tal que
	
	\begin{equation}
		|f - f_i| < \epsilon
	\end{equation}
	
	Definamos
	
	\begin{equation}
		I(\mu,f) := \int f d\mu
	\end{equation}
	
	Para $f_1$ tomemos $I(\mu_n,f_1)$. Se observa que $I(\mu_n,f_1)$ es una sucesión en $\mathbb{R}$. Entonces
	
	\begin{equation}
		|I(\mu_n,f_1)| = \left| \int f_1 d\mu_n \right| \leq \int \|f_1\| d\mu_n = \|f_1\|
	\end{equation} 
	
	$I(\mu_n,f_1)$ es una sucesión acotada en $\mathbb{R}$ entonces tiene una subsucesión convergente. Sea el conjunto $\mathbb{N}_1 \subset \mathbb{N}$ el conjunto de los índices de la subsucesión. 
	
	Ahora trabajando con los índices $\mathbb{N}_1$ se puede ver también que $I(\mu_n,f_2)$, para $n \in \mathbb{N}_1$, también es acotada. Entonces se puede tomar una subsucesión convergente con índices $\mathbb{N}_2 \subset \mathbb{N}_1$.
	
	Este proceso se puede seguir hasta conseguir un conjunto de índices $\mathbb{N}_i \subset \mathbb{N}_{i-1} \subset \ldots \subset \mathbb{N}_1 \subset \mathbb{N}$ tal que $I(\mu_n,f_j)$ sea convergente para $n \in \mathbb{N}_i$,$1 \leq j \leq i$. A está sucesión convergente se le puede extraer una subsucesión que seguirá siendo convergente al mismo límite. Sea $I(\mu_{n_i},f_i)$ una subsucesión de las antes nombradas con $n_i \in \mathbb{N}_i$. Como $I(\mu_{n_i},f_i)$ es convergente en $\mathbb{R}$ entonces es una sucesión de Cauchy. Entonces, para $\epsilon > 0$ que se eligió al inicio, existe $N \in \mathbb{N}$ tal que para $m,k > N$ se cumple
		
	\begin{equation}
		|I(\mu_{n_m},f_i) - I(\mu_{n_k},f_i)| < \epsilon
	\end{equation}
	
	Luego, para $f$ tomado al inicio, se observa lo siguiente
	
	\begin{align}
		|I(\mu_{n_m},f) - I(\mu_{n_k},f)| &\leq |I(\mu_{n_m},f) - I(\mu_{n_m},f_i) | \\
		& + |I(\mu_{n_m},f_i) - I(\mu_{n_k},f_i)| \\		
		& + |I(\mu_{n_k},f_i) - I(\mu_{n_k},f)|\\
		& < 3\epsilon
	\end{align}
	
	Entonces $I(\mu_{n_i},f)$ es una sucesión de Cauchy en $\mathbb{R}$. Por lo tanto $I(\mu_{n_i},f)$ es convergente.
	
	En resumen, se logró que para cualquier $f \in \mathcal{C}(X)$ existe una subsucesión $(\mu_{n_i})$ tal que
	
	\begin{equation}
		I(\mu_{n_i},f) = \int f d\mu_{n_i}
	\end{equation}
	
	es convergente. Sea $A: \mathcal{C}(X) \rightarrow \mathbb{R}$ tal que está definida como
	
	\begin{equation}
		Af = \lim_{i \rightarrow \infty} \int f d \mu_{n_i}
	\end{equation}
	
	Se observa que $A$ es lineal y acotado. Entonces se puede aplicar el Teorema de Representación de Riesz \cite{riesz}, Teorema 6.2.5. En conclusión, existe \mbox{$\mu \in \mathcal{M}(X,\Sigma)$} tal que
	
	\begin{equation}
		Af = \int f d\mu = \lim_{i \rightarrow \infty} \int f d \mu_{n_i}
	\end{equation}
	
	Por lo tanto $\mathcal{M}(X,\Sigma)$ es secuencialmente compacto con la topología débil*.
\end{proof}

\begin{teorema}[Teorema de Krylov-Bugoliubov]\label{krylov-bugoliubov}
	$\mathcal{M}_f(X,\Sigma)$ es no vacío, convexo y compacto.
\end{teorema}

\begin{proof}
	Recordar que por el lema \ref{krylov-bugoliubov-lema3} $\mathcal{M}(X,\Sigma)$ es compacto.
	
	Sea $\mu \in \mathcal{M}(X,\Sigma)$, para $n \geq 1$ definimos
	
	\begin{align}
		\mu_n :=& \frac{1}{n} \sum_{i=0}^{n-1} f_*^i \mu
	\end{align}
	
		Sea $\mu_{n_j} \rightarrow \mu$ algún punto límite. Afirmamos que $\mu \in \mathcal{M}_f(X,\Sigma)$, esto quiere decir, $f_*\mu = \mu$.
	
	Por continuidad de $f_*$ se tiene que $f_*\mu_{n_j} \rightarrow f_*\mu$.
	
	Es suficiente demostrar
	
	\begin{equation}
	f_*\mu_{n_j} \rightarrow \mu
	\end{equation}
	
	Veamos
	
	\begin{align}
	f_*\mu_{n_j} =& f_* \left( \frac{1}{n_j} \sum_{i=0}^{n_j-1} f^i_* \mu \right)\\
	=& \frac{1}{n_j} \sum_{i=0}^{n_j-1} f_*^{i+1} \mu\\
	=& \frac{1}{n_j} \left( \sum_{i=0}^{n_j-1} f^i_* \mu - \mu + f^{n_j}_* \mu \right)\\
	=& \frac{1}{n_j} \sum_{i=0}^{n_j-1} f^i_* \mu - \frac{\mu}{n_j} + \frac{f^{n_j}_* \mu}{n_j}\\
	=& \mu_{n_j} - \frac{\mu}{n_j} + \frac{f^{n_j}_* \mu}{n_j}
	\end{align}
	
	Cuando $n_j \rightarrow \infty$ se ve que $f_* \mu_{n_j} \rightarrow \mu$. Por lo tanto $f_*\mu=\mu$. Luego existe $\mu \in \mathcal{M}_f(X,\Sigma)$ con lo que $\mathcal{M}_f(X,\Sigma) \neq \emptyset$.
	
	Ahora vamos a probar que $\mathcal{M}_f(X,\Sigma)$ es convexo. Sea $\mu_1,\mu_2 \in \mathcal{M}_f(X,\Sigma)$, hay que demostrar que
	
	\begin{equation}
	f_*(t\mu_1 + (1-t)\mu_2) = t\mu_1 + (1-t)\mu_2, \quad t \in [0,1]
	\end{equation}
	
	Veamos. Sea $A \in \Sigma$ cualquiera, luego 
	
	\begin{align}
	f_*(t\mu_1 + (1-t)\mu_2)(A) =& (t\mu_1 + (1-t)\mu_2)(f^{-1}(A))\\
	=& t\mu_1(f^{-1}(A)) + (1-t)\mu_2(f^{-1}(A))\\
	=& t\mu_1(A) + (1-t)\mu_2(A)\\
	=& (t\mu_1 + (1-t)\mu_2)(A)
	\end{align}
	
	Luego $f_*(t\mu_1 + (1-t)\mu_2) = t\mu_1 + (1-t)\mu_2$ con lo que \mbox{$t\mu_1 + (1-t)\mu_2 \in \mathcal{M}_f(X,\Sigma)$}.
	
	Finalmente, probaremos que $\mathcal{M}_f(X,\Sigma)$ es compacto. Como sabemos que $\mathcal{M}(X,\Sigma)$ es compacto porque $M$ es compacto entonces sólo hay que probar que $\mathcal{M}_f(X,\Sigma)$ es cerrado.
	
	Sea $(\mu_n) \subset \mathcal{M}_f(X,\Sigma)$ una sucesión tal que $\mu_n \rightarrow \mu$. Hay que demostrar que $\mu \in \mathcal{M}_f(X,\Sigma)$.
	
	Por definición de convergencia en la topología débil* se tiene que, en particular, para $\varphi \circ f \in \mathcal{C}(X)$ con $\varphi \in \mathcal{C}(X)$ lo siguiente
	
	\begin{align}
	\int \varphi \circ f d\mu &= \lim_{n \rightarrow \infty} \int \varphi \circ f d\mu_n\\
	=& \lim_{n \rightarrow \infty} \int \varphi df_*\mu_n\\
	=& \lim_{n \rightarrow \infty} \int \varphi d\mu_n\\
	=& \int \varphi d\mu
	\end{align}
	
	Por \ref{lema3_krylov} se tiene $\mu \in \mathcal{M}_f(X,\Sigma)$.
\end{proof}

\begin{teorema}
	$\mu \in \varepsilon_f(X,\Sigma)$ si y solo si $\mu$ es un punto extremo de $\mathcal{M}_f(X,\Sigma)$.
\end{teorema}

\begin{proof}
	Supongamos que $\mu \notin \varepsilon_f(X,\Sigma)$. Entonces existe $A \in \Sigma_f$ tal que $\mu A \in (0,1)$. Definamos las medidas de probabilidad $\mu_1,\mu_2$ tales que
	\begin{align}
		\mu_1 B &= \frac{\mu(B \cap A)}{\mu A}\\
		\mu_2 B &= \frac{\mu(B \cap A^c)}{\mu A}
	\end{align}
	
	donde $B \in \Sigma$ cualquiera.
	
	Se observa que $\mu = (\mu A) \mu_1 + (\mu(A^c)) \mu_2$ con $\mu A \in (0,1)$. Entonces $\mu$ no es punto extremo de $\mathcal{M}(X,\Sigma)$ pero lo que se quiere es que no sea punto extremo de $\mathcal{M}_f(X,\Sigma)$. Para demostrar la última afirmación se tiene que demostrar que $\mu_1,\mu_2 \in \mathcal{M}_f(X,\Sigma)$. En efecto, sea $B \in \Sigma$ entonces
	\begin{align}
		\mu_1(f^{-1}B) &= \frac{\mu(f^{-1}B \cap A)}{\mu A}\\
		&= \frac{\mu(f^{-1}B \cap f^{-1}A)}{\mu A}\\
		&= \frac{\mu(f^{-1}(B \cap A))}{\mu A}\\
		&= \frac{\mu (B \cap A)}{\mu A}\\		
		&= \mu_1 B
	\end{align}
	
	Entonces $\mu_1 \in \mathcal{M}_f(X,\Sigma)$. Haciendo lo mismo para $\mu_2$ se tiene que\\
	$\mu_2 \in \mathcal{M}_f(X,\Sigma)$.
	
	Ahora supongamos que $\mu \in \varepsilon_f(X,\Sigma)$ y supongamos que existen\\
	$\mu_1,\mu_2 \in \mathcal{M}_f(X,\Sigma)$ tales que
	\begin{equation}
		\mu = t\mu_1 + (1-t)\mu_2, t \in (0,1)
	\end{equation}
	
	Demostraremos que lo último implica que $\mu_1=\mu_2=\mu$. 
	
	Vamos a demostrar que $\mu_2=\mu$. Se observa que $\mu_1 \ll \mu$. Luego, por el teorema de Radon-Nykodin \ref{radon-nikodyn}, existe $h_1$ no negativa tal que para cualquier $B \in \Sigma$
	\begin{equation}
		\mu_1 B = \int_B h_1 d\mu
	\end{equation}
	
	Si se demuestra que $h_1 = 1$ en c.t.p. entonces tendremos la equivalencia.
	
	Sean
	\begin{align}
		B &= \{ x \in X: h_1 x < 1 \}\\
		C &= \{ x \in X: h_1 x > 1 \}
	\end{align}
	
	Se observa que
	\begin{align}
		\mu_1 B &= \int_B h_1 d\mu\\
		&= \int_{B \cap f^{-1}B} h_1 d\mu + \int_{B \setminus f^{-1}B} h_1 d\mu
	\end{align}
	
	También se observa que
	\begin{align}
		\mu_1(f^{-1}B) &= \int_{f^{-1}B} h_1 d\mu\\
		&= \int_{f^{-1}B \cap B} h_1 d\mu + \int_{f^{-1}B \setminus B} h_1 d\mu
	\end{align}
	
	Como $\mu_1 \in \mathcal{M}_f(X,\Sigma)$ entonces $\mu_1 B = \mu_1(f^{-1}B)$.
	
	Luego
	\begin{equation}
		\int_{B \setminus f^{-1}B} h_1 d\mu = \int_{f^{-1}B \setminus B} h_1 d\mu
	\end{equation}
	
	Notar que
	\begin{align}
		\mu(f^{-1}B \setminus B) &= \mu(f^{-1}B) - \mu(f^{-1}B \cap B)\\
		&= \mu B - \mu(f^{-1}B \cap B)\\
		&= \mu(B \setminus f^{-1}B)
	\end{align}
	
	Por la definición de $B$ se tiene
	\begin{align}
		\int_{B \setminus f^{-1}B} h_1 d\mu &< \mu(B \setminus f^{-1}B)\\
		\int_{f^{-1}B \setminus B} h_1 d\mu &\geq \mu(f^{-1}B \setminus B)
	\end{align}
	
	Pero esto no llevaría a una contradicción si la medida es positiva, luego
	\begin{equation}
		\mu(B \setminus f^{-1}B) = \mu(f^{-1}B \setminus B) = 0
	\end{equation}
	
	Así $f^{-1}B=B$ en c.t.p. Luego, por la ergodicidad de $\mu$ se tiene
	\begin{equation}
		\mu B = 1 \vee \mu B = 0
	\end{equation}
	
	Si asumimos que $\mu B = 1$ entonces
	\begin{equation}
		1 = \mu M = \int_M h_1 d\mu = \int_B h_1 d\mu < \mu B = 1
	\end{equation}
	
	Contradicción. Entonces $\mu B = 0$. Procediendo similarmente con $C$ se obtiene $\mu C = 0$. Por lo tanto $h_1 = 1$ en c.t.p.
	
	Por lo tanto $\mu_1=\mu_2=\mu$.
\end{proof}

A continuación se va a exponer el Teorema Erǵodico de Birkhoff que es el estudio principal de este capítulo. La demostración se va a hacer paso a paso a través de una serie de lemas. Este teorema da un corolario que va a ser útil para dar algunas afirmaciones acerca del estudio de la rotación irracional de $S^1$.

\begin{lema}[Máxima desigualdad]\label{maxima_desigualdad}
	Sea $(X,\Sigma,\mu)$ un espacio de probabilidad. $\mu$ es $f$-invariante y $\varphi \in L^1(X,\Sigma,\mu)$. Se define $\varphi_0 = 0$ y para $n \geq 1$
	
	\begin{gather}
		\varphi_n = \sum_{i=0}^{n-1} \varphi \circ f^i\\
		\varPhi_n x = \max \{\varphi_j x : 0 \leq j \leq n\} \geq 0
	\end{gather}
	
	Sea $A = \{x \in X: \varPhi x > 0 \}$ entonces

	\begin{equation}
		\int_A \varphi d\mu \geq 0
	\end{equation}
\end{lema}

\begin{proof}
	Se ve que $\varPhi_n \in L^1(X,\Sigma,\mu)$. 
	
	Para $0 \leq j \leq n$, tenemos $\varPhi_n \geq \varphi_j$, así $\varPhi_n \circ f \geq \varphi_j \circ f$. Luego
	\begin{equation}
		\varPhi_n \circ f + \varphi \geq \varphi_j \circ f + \varphi = \varphi_{j+1}
	\end{equation}
	
	Como esto se cumple para $0 \leq j \leq n$, en particular se cumple
	\begin{align}
		(\varPhi_n \circ f)  + \varphi  &\geq \max_{1 \leq j \leq n} \varphi_j  = \varPhi_n\\
		\varphi &\geq \varPhi_n - \varPhi_n \circ f 
	\end{align}
	
	Integrando sobre $A= \{x: \varPhi_n x > 0\}$ se tiene
	\begin{equation}
		\int_A \varphi d\mu \geq \int_A \varPhi_n d\mu - \int_A \varPhi_n \circ f d\mu
	\end{equation}
	
	Como $\varPhi_n x = 0$ cuando $x \in X \setminus A$ entonces
	\begin{equation}
		\int_A \varphi d\mu \geq \int_X \varPhi_n d\mu - \int_X \varPhi_n \circ f d\mu
	\end{equation}
	
	Como $\mu$ es $f$-invariante entonces
	\begin{equation}
		\int_A \varphi d\mu \geq 0
	\end{equation}
\end{proof}

\begin{lema}\label{maxima_desigualdad_cor}
	Sea $(X,\Sigma,\mu)$ un espacio de probabilidad y $\varphi \in L^1(X,\Sigma,\mu)$. Definamos	
	\begin{equation}
		B_{\alpha} = \left\{ x \in X: \sup_{n \geq 1} \frac{1}{n} \sum_{i=0}^{n-1} \varphi \circ f^i x > \alpha \right\}
	\end{equation}
	
	entonces para cualquier $A \in \Sigma$ con $f^{-1}A=A$ se tiene	
	\begin{equation}
		\int_{B_{\alpha} \cap A} \varphi d\mu \geq \alpha \mu(B_{\alpha} \cap A)
	\end{equation}
\end{lema}

\begin{proof}
	Supongamos que $A=X$. Sea $h = \varphi - \alpha$ y, usando la notación del lema \ref{maxima_desigualdad}, tenemos
	\begin{align}
		B_{\alpha} &= \bigcup_{n=1}^{\infty} \left\{ x: \sum_{i=0}^{n-1} \varphi \circ f^i x > n \alpha \right\}\\
		&= \bigcup_{n=1}^{\infty} \{ x: \varphi_n x > 0 \}\\
		&= \bigcup_{n=1}^{\infty} \{ x: \varPhi_n x > 0 \}
	\end{align}
	
	Sea $C_n = \{ x: \varPhi_n x > 0 \}$. Se observa que $C_n \subset C_{n+1}$ y que $\chi_{C_n}$ converge a $\chi_{B_{\alpha}}$ y así $\varphi \chi_{C_n}$ converge a $\varphi \chi_{B_{\alpha}}$. Además $|\varphi \chi_{C_n}| \leq |\varphi|$. Luego, por el Teorema de Convergencia Dominada \ref{convergencia_dominada} se tiene
	\begin{equation}
		\int_{C_n} \varphi d\mu = \int_X \varphi \chi_{C_n} d\mu \rightarrow \int_X \varphi \chi_{B_{\alpha}} d\mu = \int_{B_{\alpha}} \varphi d\mu 
	\end{equation}
	
	Aplicando el lema \ref{maxima_desigualdad} de nuevo, se tiene que para todo $n \geq 1$
	\begin{equation}
		\int_{C_n} \varphi d\mu \geq 0
	\end{equation}
	
	y así
	\begin{equation}
		\int_{B_{\alpha}} \varphi d\mu
	\end{equation}
	
	Con la última desigualdad se obtiene
	\begin{equation}
		\int_{B_{\alpha}} h d\mu \geq \alpha \mu B_{\alpha}
	\end{equation}
	
	Para el caso general se trabaja con la restricción de $f$ en $A$ y se aplica máxima desigualdad en el subconjunto para obtener
	\begin{equation}
		\int_{B_{\alpha} \cap A} h d\mu \geq \alpha \mu(B_{\alpha} \cap A)
	\end{equation}
\end{proof}

\begin{lema}\label{birkhoff_lema1}
	Sean $(X,\Sigma,\mu)$ un espacio de probabilidad y $\varphi \in L^1(X,\Sigma,\mu)$. Definamos
	
	\begin{gather}
		h^* x = \limsup_{n \rightarrow \infty} \frac{1}{n} \sum_{i=0}^{n-1} \varphi \circ f^i x\\
		h_* x = \liminf_{n \rightarrow \infty} \frac{1}{n} \sum_{i=0}^{n-1} \varphi \circ f^i x
	\end{gather}
	
	Entonces $h^* = h_*$ en c.t.p.
	
\end{lema}

Antes de empezar con la demostración cabe resaltar lo siguiente. 

Definamos $a_n x$ de esta manera
\begin{equation}
a_n x = \frac{1}{n} \sum_{i=0}^{n-1} \varphi \circ f^i x
\end{equation}

Se observa que la definición anterior cumple la siguiente propiedad
\begin{equation}
\frac{n+1}{n} a_{n+1} x = a_n (fx) + \frac{1}{n} f x
\end{equation}

Si tomamos $\limsup$ y $\liminf$ cuando $n \rightarrow \infty$ entonces se tiene
\begin{align}
h^* &= h^* \circ f\\
h_* &= h_* \circ f
\end{align}

Esta propiedad va a ser utilizada en la demostración del lema anterior.

\begin{proof}	
	Para $\alpha,\beta \in \mathbb{R}$ definamos
	\begin{equation}
		E_{\alpha,\beta} = \{ x \in X: h_* x < \beta \wedge h^* x > \alpha \}
	\end{equation}
	
	Notamos
	\begin{equation}
		\{x \in X: h_* x < h^* x\} = \bigcup_{\beta < \alpha, \alpha,\beta \in \mathbb{Q}} E_{\alpha,\beta}
	\end{equation}
	
	Observar que la unión es numerable. Para demostrar que $h^* = h_*$ c.t.p. cuando $\beta < \alpha$ basta demostrar que $E_{\alpha,\beta}$ tiene medida nula. Como $h^* \circ f = h^*$ y $h_* \circ f = h_*$ entonces tenemos que $f^{-1}E_{\alpha,\beta} = E_{\alpha,\beta}$. 
	
	Si escribimos 
	\begin{equation}
		B_{\alpha} = \left\{ x \in X: \sup_{n \geq 1} \frac{1}{n} \sum_{i=0}^{n-1} \varphi \circ f^i x > \alpha \right\}
	\end{equation}
	
	entonces es claro que $E_{\alpha,\beta} \cap B_{\alpha} = E_{\alpha,\beta}$. Aplicando el lema \ref{birkhoff_lema1} se tiene
	\begin{align}
		\int_{E_{\alpha,\beta}} \varphi d\mu &= \int_{E_{\alpha,\beta} \cap B_{\alpha}} \varphi d\mu\\
		&\geq \alpha \mu(E_{\alpha,\beta} \cap B_{\alpha}) = \alpha \mu(E_{\alpha,\beta})
	\end{align}
	
	Reemplazando $\varphi,\alpha$ y $\beta$ por $-\varphi,-\beta$ y $-\alpha$ tenemos
	\begin{equation}
		\int_{E_{\alpha,\beta}} \varphi d\mu \leq \beta \mu E_{\alpha,\beta}
	\end{equation}
	
	Por lo tanto
	\begin{equation}
		\alpha \mu E_{\alpha,\beta} \leq \beta \mu E_{\alpha,\beta}
	\end{equation}
	
	y como $\beta < \alpha$ entonces $\mu E_{\alpha,\beta} = 0$. Así $h^*=h_*$ c.t.p.
\end{proof}

\begin{lema}\label{birkhoff_lema2}
	Sea $h^*$  definido en el lema \ref{birkhoff_lema1}. Entonces $h^* \in L^1(X,\Sigma,\mu)$.
\end{lema}

\begin{proof}
	Definamos
	\begin{equation}
		g_n = \left| \frac{1}{n} \sum_{i=0}^{n-1} \varphi \circ f^i \right|
	\end{equation}
	
	Se observa que $g_n \geq 0$. Aplicando la desigualdad triangular se tiene
	\begin{align}
		g_n &\leq |\varphi \circ f^i|\\		
		\int g_n d\mu &\leq \int |\varphi \circ f^i| d\mu\\
		\int g_n d\mu &\leq \int |\varphi| d\mu
	\end{align}
	
	Utilizando el Teorema de Convergenca Dominada \ref{convergencia_dominada} se concluye que
	\begin{equation}
		\int h^* d\mu \leq \int |\varphi| d\mu
	\end{equation}
	
	Por lo tanto $h^*$ es integrable i.e. $h^* \in L^1(X,\Sigma,\mu)$.
\end{proof}

\begin{lema}\label{birkhoff_lema3}
	Sea $h^*$  definido en el lema \ref{birkhoff_lema1}. Entonces
	
	\begin{equation}
		\int h^* d\mu = \int \varphi d\mu
	\end{equation}
\end{lema}

\begin{proof}
	Para $n \in \mathbb{N}$ y $k \in \mathbb{Z}$ se define
	
	\begin{equation}
		D^n_k = \left\{ x \in X: \frac{k}{n} \leq h^* x \leq \frac{k+1}{n} \right\}
	\end{equation}
	
	Para $\epsilon > 0$ cualquiera tenemos, según el corolario \ref{maxima_desigualdad_cor}, $B_{\frac{k}{n}-\epsilon}$. Es fácil ver que se cumple lo siguiente
	
	\begin{equation}
		D^n_k \cap B_{\frac{k}{n}-\epsilon} = D^n_k
	\end{equation}
	
	Entonces por el corolario \ref{maxima_desigualdad_cor} tenemos
	
	\begin{equation}
		\int_{D^n_k} \varphi d\mu \geq \left( \frac{k}{n} - \epsilon \right) \mu D^n_k
	\end{equation}
	
	Como $\epsilon > 0$ es arbitrario entonces
	
	\begin{equation}
		\int_{D^n_k} \varphi d\mu \geq  \frac{k}{n}  \mu D^n_k	
	\end{equation}
	
	
	Por otro lado, por la definición de $D^n_k$ tenemos
	
	\begin{align}
		\int_{D^n_k} h^* d\mu &\leq \frac{k+1}{n} \mu D^n_k\\
		& \leq \frac{1}{n} \mu D^n_k + \int_{D^n_k} \varphi d\mu
	\end{align}
	
	Puesto que
	
	\begin{equation}
		X = \bigcup_{k \in \mathbb{Z}} D^n_k
	\end{equation}
	
	con los $D^n_k$ disjuntos dos a dos, se puede sumar sobre $\mathbb{Z}$ el resultado anterior. Veamos
	
	\begin{align}
		\sum_{k \in \mathbb{Z}} \int_{D^n_k} h^* d\mu &\leq \frac{1}{n} \sum_{k \in \mathbb{Z}} \mu D^n_k + \sum_{k \in \mathbb{Z}} \int_{D^n_k} \varphi d\mu\\
		\int h^* d\mu &\leq \frac{1}{n} + \int \varphi d\mu
	\end{align}
	
	Esto cumple para cualquier $n \in \mathbb{N}$. Haciendo $n \rightarrow \infty$ se obtiene
	
	\begin{equation}
		\int h^* d\mu \leq \int \varphi d\mu
	\end{equation}
	
	Para completar la demostración reemplazaremos $\varphi$ por $-\varphi$. Con esto la desigualdad anterior generaría a la siguiente desigualdad
	
	\begin{equation}
		\int \varphi d\mu \leq \int h_* d\mu
	\end{equation}
	
	Por lo tanto, como por el lema \ref{birkhoff_lema1} sabemos que $h^*=h_*$ entonces
	
	\begin{equation}
		\int h^* d\mu = \int \varphi d\mu
	\end{equation}
\end{proof}

\begin{teorema}[Teorema Ergódico de Birkhoff]\label{birkhoff_thm}
	Sea $(X,\Sigma,\mu)$ un espacio de probabilidad  con $\mu$ $f$-invariante. Sea $\varphi \in L^1(X,\Sigma,\mu)$ cualquiera y $x \in X$, entonces
	
	\begin{equation}\label{birkhoff_thm_eq1}
		\frac{1}{n} \sum_{i=0}^{n-1} \varphi \circ f^i x \rightarrow E(\varphi,\Sigma_f)
	\end{equation}
	
	para $\mu$-c.t.p.
	
\end{teorema}

\begin{proof}
	Por el lema \ref{birkhoff_lema1} se tiene que $\frac{1}{n} \sum_{i=0}^{n-1} \varphi \circ f^i x$ es convergente.
	
	Por el lema \ref{birkhoff_lema3} se tiene que para cualquier $A \in \Sigma_f$
	
	\begin{equation}
		\int _A h^* d\mu = \int_A f d\mu
	\end{equation}
	
	Además también se puede comprobar que $B_{\frac{k}{n}-\epsilon} \in \Sigma_f$.
	
	Por la definición \ref{esperanza_conficionada_def} de $E(f|\Sigma_f)$ entonces $E(f|\Sigma_f)=h^*$ porque $E(f|\Sigma_f)$ es única.
	
	Por lo tanto
	
	\begin{equation}
		\lim_{n \rightarrow \infty} \frac{1}{n} \sum_{i=0}^{n-1} \varphi \circ f^i x = E(f|\Sigma_f)
	\end{equation}
\end{proof}

\begin{corolario}\label{birkhoff_corolario}
	Sea $(X,\Sigma,\mu)$ un espacio de probabilidad, $\varphi \in L^1(X,\Sigma,\mu)$ y $x \in X$. Si $\mu$ es $f$-invariante y ergódica entonces
	
	\begin{equation}
		\frac{1}{n} \sum_{i=0}^{n-1} \varphi \circ f^i x \rightarrow \int \varphi d\mu
	\end{equation}
	
	cuando $n \rightarrow \infty$ para $\mu$-c.t.p.
\end{corolario}

\begin{proof}
	Por el teorema \ref{birkhoff_thm} se tiene que
	
	\begin{equation}
		\frac{1}{n} \sum_{i=0}^{n-1} \varphi \circ f^i x \rightarrow E(\varphi|N \cap \Sigma_f)
	\end{equation}
	
	Como $N \cap \Sigma_f$ es un sub-$\sigma$-álgebra de $N$ entonces se puede aplicar la propiedad \ref{esperanza_en_sigma-algebra_trivial}. Entonces $E(\varphi|N \cap \Sigma_f) = \int E(\varphi|N \cap \Sigma_f) d\mu = \int \varphi d\mu$. 
\end{proof}